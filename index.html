<!doctype html>
<html lang="ko" data-theme="light">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Na-kyung Kim | Data Science Â· ML/DL</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>

<style>
/* ========= Theme ========= */
:root{
  --bg:#f7f8f5; --bg-accent:#eef0ec; --card:rgba(255,255,250,.78);
  --card-border:rgba(100,110,95,.22); --text:#222421; --text-muted:#686c63;
  --brand:#7a8562; --brand-2:#9da989; --gold:#d7c083;
  --ring:conic-gradient(from 220deg,#a6b08a,#c0c8a2,#dee4c9,#a6b08a);
  --shadow:0 10px 40px rgba(60,70,55,.10),0 2px 10px rgba(17,19,34,.05);
  --blur:saturate(1.05) blur(10px);
  --olive-strong:#5e6f3a; /* âœ” ì§„í•œ ì˜¬ë¦¬ë¸Œ ê³ ì • */
}
[data-theme="dark"]{
  --bg:#12140f; --bg-accent:#1a1d17; --card:rgba(25,28,22,.86);
  --card-border:rgba(180,190,170,.14); --text:#e9eae6; --text-muted:#b4b8aa;
  --brand:#aab795; --brand-2:#c2ceb1; --gold:#c6b470;
  --ring:conic-gradient(from 220deg,#9ca88a,#b8c4a1,#d2dac2,#9ca88a);
  --shadow:0 10px 40px rgba(0,0,0,.35),inset 0 0 0 1px rgba(180,190,200,.06);
  --blur:saturate(1) blur(8px);
  --olive-strong:#5e6f3a; /* âœ” ë‹¤í¬ì—ì„œë„ ë™ì¼ */
}

/* ========= Base ========= */
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  font-family:Inter,Pretendard,system-ui,-apple-system,"Segoe UI","Noto Sans KR",Roboto,Arial,sans-serif;
  background:
    radial-gradient(1200px 600px at 8% -10%, rgba(146,158,112,.16), transparent 55%),
    radial-gradient(1000px 520px at 100% 0%, rgba(180,190,150,.12), transparent 55%),
    linear-gradient(180deg, rgba(255,255,245,.70), rgba(255,255,245,.70)),
    var(--bg);
  transition: background .3s ease, color .3s ease;
}
a{color:var(--brand);text-decoration:none}
a:hover{opacity:.9}

/* Layout */
.wrap{min-height:100svh;display:grid;grid-template-columns:300px 1fr}
@media (max-width:1080px){.wrap{grid-template-columns:1fr}}

/* ========= Sidebar ========= */
.sidebar{
  position:sticky;top:0;height:100svh;overflow:auto;overflow-x:hidden;width:300px;
  backdrop-filter:var(--blur); background:var(--card);
  border-right:1px solid var(--card-border); box-shadow:var(--shadow); padding:22px 18px;
}
@media (max-width:1080px){.sidebar{position:relative;height:auto;width:auto}}
.brand{display:flex;flex-direction:column;align-items:center;gap:14px}
.avatar-ring{width:160px;aspect-ratio:1/1;border-radius:50%;background:var(--ring);display:grid;place-items:center;padding:6px;box-shadow:0 0 30px rgba(215,192,131,.35),0 0 22px rgba(122,133,98,.25);flex:0 0 160px}
.avatar-mask{width:100%;height:100%;aspect-ratio:1/1;border-radius:50%;overflow:hidden;position:relative;background:#e8eadf}
.avatar-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;display:block}
.avatar-fallback{position:absolute;inset:0;display:grid;place-items:center;font-weight:900;font-size:40px;color:#2b301f}
.name{font-size:1.35rem;font-weight:800;display:flex;gap:.5rem;align-items:center}
.role{color:var(--text-muted);font-size:.95rem;display:flex;gap:.5rem;align-items:center}
.quick{margin:18px 0 10px;font-weight:800;color:var(--text-muted)}
.menu{display:grid;gap:10px;margin-bottom:14px}
.menu a{
  display:flex;align-items:center;gap:.6rem;padding:.6rem .8rem;border-radius:12px;
  border:1px solid var(--card-border);background:rgba(255,255,250,.7);
  box-shadow:0 2px 10px rgba(50,60,40,.04);
  color:var(--olive-strong);font-weight:700; /* âœ” QuickLinks ì§„í•œ ì˜¬ë¦¬ë¸Œ */
}
.menu a:hover{box-shadow:0 8px 22px rgba(122,133,98,.18);background:rgba(255,255,250,.95)}
.side-card{margin-top:12px;padding:12px;border-radius:16px;background:var(--card);border:1px solid var(--card-border);box-shadow:var(--shadow)}
.side-card h4{margin:.2rem 0 .6rem;font-size:1rem;color:var(--text)}
.pill{display:inline-block;margin:6px 6px 0 0;padding:.28rem .55rem;border-radius:999px;border:1px solid var(--card-border);background:var(--bg-accent);color:var(--brand);font-size:.82rem;font-weight:600}
.contact{color:var(--text-muted);font-size:.9rem;margin-top:10px}
.kbtn{display:block;margin-top:8px;padding:.6rem .7rem;border-radius:12px;border:1px solid var(--card-border);background:var(--bg-accent);color:var(--text)}

/* ========= Main ========= */
.main{padding:26px 28px}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;position:sticky;top:0;z-index:10;backdrop-filter:var(--blur)}
.toggle-wrap{display:flex;gap:8px;align-items:center}
.lock,.theme{display:inline-flex;gap:.4rem;align-items:center;border:1px solid var(--card-border);background:var(--card);color:var(--text);border-radius:999px;padding:.35rem .65rem;font-size:.85rem;cursor:pointer;box-shadow:var(--shadow)}
.lock[aria-pressed="true"], .theme[aria-pressed="true"]{outline:2px solid rgba(215,192,131,.35)}
.hero{border-radius:0;padding:8px 0 14px;background:transparent;border:none;box-shadow:none}
.hero h1{margin:0 0 .6rem;font-size:2.2rem;line-height:1.12;color:var(--olive-strong)} /* âœ” íƒ€ì´í‹€ */
.hero p{margin:.2rem 0 0;max-width:1100px;font-size:1.05rem;color:var(--olive-strong)} /* âœ” ë¶€ì œ */
.cat-panel{margin:14px 0 18px;padding:12px;border:1px dashed rgba(122,133,98,.35);border-radius:14px;background:var(--bg-accent)}
.chips{display:flex;flex-wrap:wrap;gap:.5rem}
.chip{display:inline-block;padding:.42rem .75rem;border-radius:999px;border:1px solid var(--card-border);background:#fff;color:var(--brand);font-size:.86rem;font-weight:700;box-shadow:0 4px 14px rgba(122,133,98,.12)}
[data-theme="dark"] .chip{background:#1c2119;color:#dfe6d2;border-color:rgba(200,210,180,.18)}
.chip:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(122,133,98,.18);border-color:var(--gold)}
.grid{display:grid;grid-template-columns:1.2fr .9fr;gap:18px}
@media (max-width:1080px){.grid{grid-template-columns:1fr}}
.card{border-radius:18px;padding:16px;background:var(--card);border:1px solid var(--card-border);box-shadow:var(--shadow)}
.card h3{margin:.1rem 0 .8rem;font-size:1.12rem}
.sub{color:var(--text-muted);font-size:.95rem;margin:.2rem 0 .8rem}
.catlist{display:grid;gap:10px}
.catrow{display:flex;justify-content:space-between;align-items:center;padding:.7rem .9rem;border-radius:12px;border:1px solid var(--card-border);background:rgba(255,255,250,.70)}
[data-theme="dark"] .catrow{background:#0f1410}
.badge{font-size:.8rem;color:#2a311f;background:linear-gradient(145deg,var(--brand-2),var(--brand));border:none;border-radius:999px;padding:.2rem .55rem;font-weight:700;box-shadow:inset 0 1px 0 rgba(255,255,255,.35)}
.contents-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:14px}
@media (max-width:960px){.contents-grid{grid-template-columns:1fr}}
.q-card{border-radius:16px;padding:12px;background:var(--card);border:1px solid var(--card-border);box-shadow:var(--shadow)}
.q-card h4{margin:.1rem 0 .5rem}
.q-list{margin:.2rem 0 0;padding-left:1.1rem;color:var(--text)}
.q-list li{margin:.26rem 0}
.q-list a{color:var(--text);font-weight:600}
.q-list a:hover{color:var(--brand)}
.card h3::after, .q-card h4::after, .hero h1::after{content:"";display:block;width:84px;height:3px;background:linear-gradient(90deg,var(--gold),transparent);border-radius:2px;margin-top:6px}

/* ========= Modal ========= */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}
.modal.open{display:flex}
.modal-card{width:min(720px,92vw);background:var(--card);border:1px solid var(--card-border);border-radius:18px;box-shadow:var(--shadow);padding:16px}
.modal-card h3{margin:.2rem 0 .8rem}
.form-row{display:grid;gap:8px;margin:.6rem 0}
textarea,input,select{width:100%;border:1px solid var(--card-border);background:#fff;color:#111;border-radius:12px;padding:.7rem}
[data-theme="dark"] textarea,[data-theme="dark"] input,[data-theme="dark"] select{background:#0e1534;color:#e9eae6}
.modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
.btn{border:1px solid var(--card-border);background:var(--card);color:var(--text);border-radius:12px;padding:.55rem .9rem;cursor:pointer}
.btn.primary{border-color:transparent;background:linear-gradient(145deg,var(--brand-2),var(--brand));color:#1f2615;box-shadow:0 8px 24px rgba(122,133,98,.25);font-weight:800}
.btn.primary:hover{box-shadow:0 0 20px var(--gold);transform:translateY(-2px)}

/* ========= Owner Edit UI ========= */
.owner-on .edit-btn{display:inline-flex}
.edit-btn{
  display:none; align-items:center; justify-content:center;
  width:24px; height:24px; border-radius:8px; margin-left:6px;
  border:1px solid var(--card-border); background:var(--bg-accent); color:var(--olive-strong);
  font-size:14px; cursor:pointer;
}
.owner-on .toolbar{display:flex}
.toolbar{display:none; gap:8px; margin-bottom:8px}
.toolbar .tbtn{
  padding:.35rem .55rem; border-radius:10px; border:1px solid var(--card-border);
  background:var(--bg-accent); cursor:pointer; font-size:.85rem; color:var(--text);
}
.tiny-actions{display:flex; gap:6px; margin-left:6px}
.tiny{display:none}
.owner-on .tiny{display:inline-flex}
.tiny button{
  width:24px;height:24px;border-radius:8px;border:1px solid var(--card-border);
  background:var(--bg-accent); color:var(--olive-strong); cursor:pointer; font-size:13px;
}
</style>
</head>
<body>
<div class="wrap">
  <!-- ===== Sidebar ===== -->
  <aside class="sidebar">
    <div class="brand">
      <div class="avatar-ring">
        <div class="avatar-mask">
          <img src="./images/profile.png" alt="Na-kyung Kim" class="avatar-img"
               onerror="this.style.display='none';document.getElementById('avatarFallback').style.display='grid';" loading="eager"/>
          <div id="avatarFallback" class="avatar-fallback" style="display:none;">NK</div>
        </div>
      </div>
      <div class="name">
        <span id="cfg_name">Na-kyung Kim</span>
        <button class="edit-btn" id="editName" title="ì´ë¦„ ìˆ˜ì •">âœï¸</button>
      </div>
      <div class="role">
        <span id="cfg_role">Data Science Â· ML/DL</span>
        <button class="edit-btn" id="editRole" title="ì—­í• /ì§ë¬´ ìˆ˜ì •">âœï¸</button>
      </div>
    </div>

    <div class="quick">Quick Links</div>
    <nav class="menu" id="quickLinks">
      <a href="/">ğŸ  Home</a>
      <a href="#resume">ğŸ§· Resume</a>
      <a href="#contents">ğŸ—‚ Contents</a>
      <a href="#categories">ğŸ—‚ Categories</a>
    </nav>

    <div class="side-card">
      <h4>Tags</h4>
      <div id="tagPills">
        <span class="pill">Python</span><span class="pill">Machine Learning</span>
        <span class="pill">Deep Learning</span><span class="pill">Data Viz</span><span class="pill">MLOps</span>
      </div>
    </div>

    <div class="side-card contact">
      <a class="kbtn" href="mailto:neige040515@gmail.com">ğŸ“§ neige040515@gmail.com</a>
      <a class="kbtn" target="_blank" href="https://github.com/carolyn0515">ğŸŒ github.com/carolyn0515</a>
      <a class="kbtn" href="#">ğŸ« Dankook Univ.</a>
    </div>
  </aside>

  <!-- ===== Main ===== -->
  <main class="main">
    <div class="topbar">
      <div class="toolbar" id="ownerToolbar">
        <button class="tbtn" id="addCat">â• ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
        <button class="tbtn" id="addTL">â• ì´ë ¥ ì¶”ê°€</button>
        <button class="tbtn" id="resetData">â†º ì´ˆê¸°í™”(ê¸°ë³¸ê°’)</button>
      </div>
      <div class="toggle-wrap">
        <button id="themeBtn" class="theme" aria-pressed="false">â˜€ï¸ Light</button>
        <button id="lockBtn" class="lock" aria-pressed="false">ğŸ”’ Owner</button>
      </div>
    </div>

    <section class="hero">
      <h1>Understanding the world through data, and helping people make better decisions.</h1>
      <p><em>This portfolio documents <strong id="cfg_name_inline">Na-kyung Kim</strong>'s journey in Data Science &amp; Machine Learning â€” real-world projects, research notes, and hands-on learnings.</em></p>
      <div class="cat-panel"><div class="chips" id="topChips"></div></div>
    </section>

    <section class="grid">
      <div class="card">
        <h3 style="display:flex;align-items:center;gap:8px">
  ì´ë ¥ / Highlights
  <span class="tiny">
    <button title="ì´ë ¥ ì¶”ê°€" data-act="add-tl">â•</button>
  </span>
</h3>

      </div>

      <div class="card" id="categories">
        <h3>ì¹´í…Œê³ ë¦¬ ì¸ë±ìŠ¤</h3>
        <div class="catlist" id="catList"></div>
      </div>
    </section>

    <section class="contents-grid" id="contents"></section>
  </main>
</div>

<!-- ===== Owner Login Modal ===== -->
<div class="modal" id="ownerModal">
  <div class="modal-card">
    <h3>Owner ë¡œê·¸ì¸</h3>
    <div class="form-row">
      <label for="ownerPass">ë¹„ë°€ë²ˆí˜¸</label>
      <input id="ownerPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"/>
    </div>
    <div class="modal-actions">
      <button class="btn" id="ownerCancel">ì·¨ì†Œ</button>
      <button class="btn primary" id="ownerOk">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
/* ========= Config ========= */
const OWNER_PASS_HASH = "2ffb19123989a7a76ef9d8504042c027d39e245aeab3bc5699ecd26078edeaaa";
let owner = false;
const $ = s => document.querySelector(s);

/* í‹°ìŠ¤í† ë¦¬ RSS + í‚¤ì›Œë“œ(ì œëª© í¬í•¨ ë§¤ì¹­ìš©) */
const BLOG = {
  rss: "https://carolyn0515.tistory.com/rss",
  maxPerCategory: 6,
  titleKeywords: {
    "í˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ + ë”¥ëŸ¬ë‹": ["í˜¼ì ê³µë¶€í•˜ëŠ”", "ë”¥ëŸ¬ë‹", "ë¨¸ì‹ ëŸ¬ë‹", "ch."],
    "Deep Learning step 1": ["Deep Learning step 1", "ì‹ ê²½ë§", "ë¡œì§€ìŠ¤í‹±"]
  }
};

/* ========= ê¸°ë³¸ ë°ì´í„° ========= */
const defaults = {
  profile:{ name:"Na-kyung Kim", role:"Data Science Â· ML/DL" },
  cats:[
    {name:"í˜¼ì ê³µë¶€í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ + ë”¥ëŸ¬ë‹", count:null, url:"#"},
    {name:"Deep Learning step 1", count:null, url:"#"}
  ],
  timeline:[
    {title:"DKU CI Lab â€” Undergraduate Researcher", sub:"PHQ-9 ê¸°ë°˜ ê°œì„ í™•ë¥  ì˜ˆì¸¡ Â· CATE uplift Â· GRU encoder"},
    {title:"ReFit â€” NIR ì˜ë¥˜ ë¶„ë¥˜ Â· ìˆœí™˜ê²½ì œ í”Œë«í¼", sub:"spectrum signal â†’ clothing class Â· citizen incentive loop"},
    {title:"Pulse-based ECG Fitness Game (Mobile)", sub:"Android Â· real-time bio-signal driven gamification"}
  ]
};
function loadData(){
  try{
    const j = JSON.parse(localStorage.getItem('nk_portfolio')||'null');
    return j?j:JSON.parse(JSON.stringify(defaults));
  }catch(e){return JSON.parse(JSON.stringify(defaults));}
}
function saveData(){
  localStorage.setItem('nk_portfolio', JSON.stringify(data));
  renderStatic();
  buildContents();
}
let data = loadData();

/* ========= Owner ========= */
async function sha256(txt){
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(txt));
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
}
function requestOwner(){
  return new Promise(resolve=>{
    const m = $('#ownerModal'), inp = $('#ownerPass'), ok = $('#ownerOk'), cancel = $('#ownerCancel');
    function close(res){ m.classList.remove('open'); ok.onclick = cancel.onclick = null; resolve(res); }
    ok.onclick = async ()=>{ const h = await sha256(inp.value||''); close(h===OWNER_PASS_HASH); };
    cancel.onclick = ()=> close(false);
    m.classList.add('open'); inp.value=''; inp.focus();
  });
}
function setOwnerMode(on){
  owner = on;
  document.body.classList.toggle('owner-on', on);
  $('#lockBtn').setAttribute('aria-pressed', on?'true':'false');
  localStorage.setItem('nk_owner', on?'1':'0');
  // íˆ´ë°” í‘œì‹œ/ìˆ¨ê¹€
  $('#ownerToolbar').style.display = on ? 'flex' : 'none';
}
$('#lockBtn').addEventListener('click', async ()=>{
  if(!owner){ if(await requestOwner()) setOwnerMode(true); else alert('Wrong password.'); }
  else setOwnerMode(false);
});
setOwnerMode(localStorage.getItem('nk_owner')==='1');

/* ========= Theme ========= */
const root = document.documentElement, themeBtn = $('#themeBtn');
function applyTheme(t){
  root.setAttribute('data-theme', t);
  const isDark = t==='dark';
  themeBtn.textContent = isDark ? 'ğŸŒ™ Dark' : 'â˜€ï¸ Light';
  themeBtn.setAttribute('aria-pressed', isDark?'true':'false');
  localStorage.setItem('nk_theme', t);
}
applyTheme(localStorage.getItem('nk_theme') || (root.getAttribute('data-theme')||'light'));
themeBtn.addEventListener('click', ()=>applyTheme(root.getAttribute('data-theme')==='light'?'dark':'light'));

/* ========= Static render ========= */
function renderStatic(){
  // í”„ë¡œí•„
  $('#cfg_name').textContent = data.profile.name;
  $('#cfg_role').textContent = data.profile.role;
  $('#cfg_name_inline').textContent = data.profile.name;
  const initials = (data.profile.name||'').split(/\s+/).map(w=>w[0]||'').slice(0,2).join('').toUpperCase();
  const fb = document.getElementById('avatarFallback'); if(fb) fb.textContent = initials || 'NK';

  // ì¹´í…Œê³ ë¦¬ ì¸ë±ìŠ¤ & ì¹©
  const top = document.getElementById('topChips'); top.innerHTML='';
  const cl = document.getElementById('catList'); cl.innerHTML='';
  data.cats.forEach((c,i)=>{
    const chip = document.createElement('a'); chip.className='chip'; chip.href=`#cat-${i}`; chip.textContent=c.name; top.appendChild(chip);
    const row = document.createElement('div'); row.className='catrow';
    row.innerHTML =
      `<div style="display:flex;align-items:center;gap:6px">
         <a href="#cat-${i}" style="color:inherit">${c.name}</a>
         <span class="tiny">
           <button title="ì´ë¦„ ìˆ˜ì •" data-act="edit-cat" data-i="${i}">âœï¸</button>
           <button title="ì‚­ì œ" data-act="del-cat" data-i="${i}">ğŸ—‘ï¸</button>
         </span>
       </div>
       <span class="badge" id="cat-count-${i}">${c.count??0}</span>`;
    cl.appendChild(row);
  });

  // ì´ë ¥
  const tl = document.getElementById('timeline'); tl.innerHTML='';
  data.timeline.forEach((x,idx)=>{
    const d=document.createElement('div'); d.style.margin='10px 0';
    d.innerHTML=
      `<strong>${x.title}</strong>
       <span class="tiny-actions tiny">
         <button title="ìˆ˜ì •" data-act="edit-tl" data-i="${idx}">âœï¸</button>
         <button title="ì‚­ì œ" data-act="del-tl" data-i="${idx}">ğŸ—‘ï¸</button>
       </span>
       <br/><span class="sub">${x.sub||''}</span>`;
    tl.appendChild(d);
  });
}
renderStatic();

/* ========= Owner edit handlers ========= */
// ì´ë¦„/ì—­í• 
document.getElementById('editName').addEventListener('click', ()=>{
  if(!owner) return; const v = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', data.profile.name || '');
  if(v && v.trim()){ data.profile.name = v.trim(); saveData(); }
});
document.getElementById('editRole').addEventListener('click', ()=>{
  if(!owner) return; const v = prompt('ì—­í• /ì§ë¬´ë¥¼ ì…ë ¥í•˜ì„¸ìš”', data.profile.role || '');
  if(v && v.trim()){ data.profile.role = v.trim(); saveData(); }
});

// ì¹´í…Œê³ ë¦¬ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ
document.getElementById('addCat').addEventListener('click', ()=>{
  if(!owner) return;
  const name = prompt('ìƒˆ ì¹´í…Œê³ ë¦¬ ì´ë¦„', '');
  if(name && name.trim()){
    data.cats.push({name:name.trim(), count:null, url:'#'});
    saveData();
  }
});
document.getElementById('catList').addEventListener('click',(e)=>{
  if(!owner) return;
  const btn = e.target.closest('button'); if(!btn) return;
  const i = Number(btn.dataset.i);
  if(btn.dataset.act === 'edit-cat'){
    const v = prompt('ì¹´í…Œê³ ë¦¬ ì´ë¦„ ìˆ˜ì •', data.cats[i].name);
    if(v && v.trim()){ data.cats[i].name = v.trim(); saveData(); }
  }else if(btn.dataset.act === 'del-cat'){
    if(confirm('ì‚­ì œí• ê¹Œìš”?')){ data.cats.splice(i,1); saveData(); }
  }
});

// ì´ë ¥ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ
document.getElementById('addTL').addEventListener('click', ()=>{
  if(!owner) return;
  const t = prompt('ì´ë ¥ ì œëª©', 'New Highlight');
  if(!t) return;
  const s = prompt('ì„¸ë¶€ë‚´ìš©(ì„œë¸Œí…ìŠ¤íŠ¸)', '');
  data.timeline.unshift({title:t, sub:s||''});
  saveData();
});
document.getElementById('timeline').addEventListener('click',(e)=>{
  if(!owner) return;
  const btn = e.target.closest('button'); if(!btn) return;
  const i = Number(btn.dataset.i);
  if(btn.dataset.act === 'edit-tl'){
    const t = prompt('ì´ë ¥ ì œëª© ìˆ˜ì •', data.timeline[i].title);
    if(t==null) return;
    const s = prompt('ì„¸ë¶€ë‚´ìš© ìˆ˜ì •', data.timeline[i].sub||'');
    data.timeline[i] = {title:t, sub:s||''}; saveData();
  }else if(btn.dataset.act === 'del-tl'){
    if(confirm('ì‚­ì œí• ê¹Œìš”?')){ data.timeline.splice(i,1); saveData(); }
  }
});

// ê¸°ë³¸ê°’ ì´ˆê¸°í™”
document.getElementById('resetData').addEventListener('click', ()=>{
  if(!owner) return;
  if(confirm('ëª¨ë“  ì‚¬ìš©ì ë°ì´í„°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')){
    localStorage.removeItem('nk_portfolio');
    data = loadData();
    saveData();
  }
});

/* ========= RSS Fetch ========= */
async function fetchWithFallback(url){
  const targets = [
    `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
    `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
    url
  ];
  for(const t of targets){
    try{
      const r = await fetch(t, {cache:'no-store'});
      if(!r.ok) continue;
      if(t.includes('allorigins')){ const j=await r.json(); if(j?.contents) return j.contents; }
      else if(t.includes('api.codetabs')){ return await r.text(); }
      else { return await r.text(); }
    }catch(_){}
  }
  return '';
}
function norm(s){return (s||'').toString().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,'').trim();}
function attachTopTarget(a){
  if(!a) return;
  a.setAttribute('target','_top'); a.setAttribute('rel','noopener noreferrer');
  a.addEventListener('click', (e)=>{
    const href=a.getAttribute('href');
    if(href && /^https?:\/\//i.test(href)){
      try{ window.top.location.href = href; e.preventDefault(); }catch(_){}
    }
  });
}
function parseFeed(text){
  if(!text) return [];
  try{ const j=JSON.parse(text); if(j.items){ return j.items.map(it=>({title:it.title||'(untitled)',link:it.url||it.external_url||'#',categories:it.tags||it.categories||[]})); } }catch(_){}
  const xml=new DOMParser().parseFromString(text,"text/xml");
  const isRSS = xml.querySelectorAll('item').length>0;
  if(isRSS){
    return [...xml.querySelectorAll('item')].map(it=>({
      title: it.querySelector('title')?.textContent?.trim() || '(untitled)',
      link:  it.querySelector('link')?.textContent?.trim() || '#',
      categories: [...it.querySelectorAll('category')].map(c=>c.textContent.trim())
    }));
  }else{
    return [...xml.querySelectorAll('entry')].map(en=>({
      title: en.querySelector('title')?.textContent?.trim() || '(untitled)',
      link:  en.querySelector('link')?.getAttribute('href') || '#',
      categories: [...en.querySelectorAll('category')].map(c=>c.getAttribute('term')||c.textContent.trim())
    }));
  }
}

/* ========= Build Contents ========= */
async function buildContents(){
  const cont = document.getElementById('contents'); cont.innerHTML='';
  const text = await fetchWithFallback(BLOG.rss);
  const posts = parseFeed(text);

  function isMatch(post, catName){
    const catN = norm(catName);
    const cats = (post.categories||[]).map(norm);
    if(cats.some(c=>c.includes(catN)||catN.includes(c))) return true;
    const titleN = norm(post.title);
    const kws = BLOG.titleKeywords[catName] || [];
    if(kws.some(k=>titleN.includes(norm(k)))) return true;
    return false;
  }

  data.cats.forEach((c,idx)=>{
    const card = document.createElement('div'); card.className='q-card'; card.id=`cat-${idx}`;
    const h4=document.createElement('h4'); h4.textContent=c.name;
    const ul=document.createElement('ul'); ul.className='q-list';

    let list = posts.filter(p=>isMatch(p,c.name)).slice(0,BLOG.maxPerCategory);
    if(list.length===0){ list = posts.slice(0, Math.min(BLOG.maxPerCategory, posts.length)); }

    const badge = document.getElementById(`cat-count-${idx}`); if(badge) badge.textContent = list.length;

    list.forEach(p=>{
      const li=document.createElement('li');
      const a=document.createElement('a'); a.textContent=p.title; a.href=p.link||'#'; attachTopTarget(a);
      li.appendChild(a); ul.appendChild(li);
    });

    card.appendChild(h4); card.appendChild(ul); cont.appendChild(card);
  });
}
buildContents();
</script>
</body>
</html>
